#!/bin/bash

# ---------------------------------------------------------------------------
# Creative Commons CC BY 4.0 - SPLENT - Diverso Lab
# ---------------------------------------------------------------------------
# This script is licensed under the Creative Commons Attribution 4.0 
# International License. You are free to share and adapt the material 
# as long as appropriate credit is given, a link to the license is provided, 
# and you indicate if changes were made.
# https://creativecommons.org/licenses/by/4.0/
# ---------------------------------------------------------------------------

#!/bin/bash
set -e

echo "üöÄ [Core requirements] entrypoint starting..."

# Check if splent_framework is already installed in editable mode
if [ -d /workspace/splent_framework ]; then
    if ! pip show -f splent_framework | grep -q "/workspace/splent_framework"; then
        echo "üîÅ Installing splent_framework in editable mode..."
        pip install --no-cache-dir --root-user-action=ignore -e /workspace/splent_framework
    else
        echo "‚úÖ splent_framework already installed in editable mode."
    fi
else
    echo "üì¶ Installing splent_framework from pyproject.toml [core]..."
    pip install --no-cache-dir "{{ product_name }}[core]"
fi

# Check if splent_cli is already installed
if [ -d /workspace/splent_cli ]; then
    if ! pip show -f splent_cli | grep -q "/workspace/splent_cli"; then
        echo "üîÅ Installing splent_cli in editable mode (with [dev])..."
        pip install --no-cache-dir --root-user-action=ignore -e /workspace/splent_cli
        pip install --no-cache-dir --root-user-action=ignore -e /workspace/splent_cli[dev]
    else
        echo "‚úÖ splent_cli already installed in editable mode."
    fi
else
    echo "‚ö†Ô∏è  splent_cli directory not found. Skipping editable install."
fi

echo "‚úÖ [Core requirements] entrypoint finished."

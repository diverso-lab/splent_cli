services:

  {{ product_name }}_web:
    build:
      context: /workspace
      dockerfile: /workspace/{{ product_name }}/docker/Dockerfile.{{ product_name }}.dev
    container_name: {{ product_name }}_web
    volumes:
      - ${SPLENT_HOST_PROJECT_DIR}:/workspace
    env_file:
      - /workspace/{{ product_name }}/docker/.env
    ports:
      - "{{ web_port }}:5000"
    depends_on:
      - {{ product_name }}_db
      - {{ product_name }}_redis
    networks:
      - splent_network
    command: [ "tail", "-f", "/dev/null" ]

  {{ product_name }}_db:
    image: mariadb:latest
    container_name: {{ product_name }}_db
    env_file:
      - /workspace/{{ product_name }}/docker/.env
    command: --default-authentication-plugin=mysql_native_password
    ports:
      - "{{ db_port }}:3306"
    volumes:
      - {{ product_name }}_db_data:/var/lib/mysql
    networks:
      - splent_network

  {{ product_name }}_redis:
    container_name: {{ product_name }}_redis_container
    image: redis:latest
    restart: always
    ports:
      - "{{ redis_port }}:6379"
    networks:
      - splent_network

volumes:
  {{ product_name }}_db_data:

networks:

  splent_network:
    driver: bridge
    name: splent_network
